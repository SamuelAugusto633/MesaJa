<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MesaJa - Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <header class="global-header">
        <div class="social-links">
            <a href="#" title="Youtube"><img src="/static/icones/youtube.png" alt="YouTube"></a>
            <a href="#" title="Facebook"><img src="/static/icones/facebook.png" alt="Facebook"></a>
            <a href="#" title="Twitter"><img src="/static/icones/twitter.png" alt="Twitter"></a>
            <a href="#" title="Instagram"><img src="/static/icones/instagram.png" alt="Instagram"></a>
        </div>
        <nav class="nav-links">
            <a href="#">Conheça nossos recursos</a>
            <a href="#">Versão de testes</a>
            <a href="#">Nossas promoções e planos</a>
            <a href="#">Tutorial</a>
            <a href="#">Fale conosco</a>
        </nav>
    </header>

    <main class="dashboard-container">
        <div class="dashboard-header">
            <div class="welcome-area">
                <h2>Olá, {{ user_name }}</h2>
                <a href="/logout" class="logout-link">(Sair)</a>
            </div>
            <div class="notification-bar">
                <p>Carregando notificações...</p>
            </div>
        </div>

        <section class="main-menu">
            <a href="/central-interacoes" class="menu-link">
                <div class="menu-button">
                    <div class="menu-button-icon-placeholder"></div>
                    <h3>Central de Interação</h3>
                </div>
            </a>
            <a href="/fila-atual" class="menu-link">
                <div class="menu-button">
                    <div class="menu-button-icon-placeholder"></div>
                    <h3>Fila Atual</h3>
                </div>
            </a>
            <a href="/status-mesas" class="menu-link">
                <div class="menu-button">
                    <div class="menu-button-icon-placeholder"></div>
                    <h3>Status das Mesas</h3>
                </div>
            </a>
            <a href="/menu-garcons" class="menu-link">
                <div class="menu-button">
                    <div class="menu-button-icon-placeholder"></div>
                    <h3>Menu de Garçons</h3>
                </div>
            </a>
            <a href="/menu-promocional" class="menu-link">
                <div class="menu-button">
                    <div class="menu-button-icon-placeholder"></div>
                    <h3>Menu Promocional</h3>
                </div>
            </a>
            <a href="/menu-relatorios" class="menu-link">
                <div class="menu-button">
                    <div class="menu-button-icon-placeholder"></div>
                    <h3>Gerar Relatório</h3>
                </div>
            </a>
        </section>
    </main>

    <script>
        const notificationBar = document.querySelector('.notification-bar');

        async function atualizarNotificacoes() {
            try {
                const response = await fetch('/notificacoes/');
                if (!response.ok) return; // Se falhar, não faz nada
                const notificacoes = await response.json();

                if (notificacoes.length > 0) {
                    const textoNotificacoes = notificacoes.join(' ••• ');
                    // Verifica se o texto mudou antes de atualizar, para reiniciar a animação
                    const ticker = document.getElementById('notification-ticker');
                    if (!ticker || ticker.innerText !== textoNotificacoes) {
                         notificationBar.innerHTML = `<p id="notification-ticker">${textoNotificacoes}</p>`;
                    }
                } else {
                    notificationBar.innerHTML = '<p>Nenhuma notificação recente.</p>';
                }
            } catch (error) {
                console.error("Erro ao buscar notificações:", error);
            }
        }

        // Garante que a função é chamada na inicialização e depois em intervalos
        document.addEventListener('DOMContentLoaded', () => {
            atualizarNotificacoes();
            setInterval(atualizarNotificacoes, 3000); // Atualiza a cada 5 segundos
        });
    </script>
</body>
</html>